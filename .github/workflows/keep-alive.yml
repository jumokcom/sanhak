name: Keep Render Server Alive

on:
  schedule:
    # 10ë¶„ë§ˆë‹¤ ì‹¤í–‰ (ë Œë” ë¬´ë£Œí”Œëœ 15ë¶„ ì œí•œë³´ë‹¤ ì§§ê²Œ)
    - cron: '*/10 * * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥í•˜ê²Œ
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for manual trigger'
        required: false
        default: 'Manual keep-alive'

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“… Log execution time
      run: |
        echo "Keep-alive job started at: $(date)"
        echo "Timezone: $(timedatectl show --property=Timezone --value 2>/dev/null || echo 'UTC')"
    
    - name: ğŸ“ Ping backend server
      run: |
        echo "Pinging backend server..."
        response=$(curl -s -w "\n%{http_code}" https://sanhak-backend.onrender.com/keep-alive)
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | head -n -1)
        
        echo "Response body: $body"
        echo "HTTP status: $http_code"
        
        if [ "$http_code" -eq 200 ]; then
          echo "âœ… Backend keep-alive successful!"
        else
          echo "âŒ Backend keep-alive failed with status: $http_code"
          exit 1
        fi
    
    - name: ğŸ” Check backend health
      run: |
        echo "Checking backend health..."
        response=$(curl -s -w "\n%{http_code}" https://sanhak-backend.onrender.com/health)
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | head -n -1)
        
        echo "Health check response: $body"
        echo "HTTP status: $http_code"
        
        if [ "$http_code" -eq 200 ]; then
          echo "âœ… Backend health check passed!"
        else
          echo "âŒ Backend health check failed with status: $http_code"
          exit 1
        fi
    
    - name: ğŸŒ Ping frontend (if deployed to Render)
      run: |
        echo "Pinging frontend..."
        # í”„ë¡ íŠ¸ì—”ë“œ URLì„ ì‹¤ì œ ë°°í¬ URLë¡œ ë³€ê²½í•˜ì„¸ìš”
        frontend_url="https://sanhak.onrender.com"
        
        response=$(curl -s -w "\n%{http_code}" "$frontend_url")
        http_code=$(echo "$response" | tail -n1)
        
        echo "Frontend HTTP status: $http_code"
        
        if [ "$http_code" -eq 200 ]; then
          echo "âœ… Frontend ping successful!"
        else
          echo "âš ï¸ Frontend ping failed with status: $http_code (this might be normal if not deployed to Render)"
        fi
    
    - name: ğŸ“Š Summary
      run: |
        echo "ğŸ‰ Keep-alive job completed successfully!"
        echo "Next execution in ~10 minutes"
